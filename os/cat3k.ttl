; .======================================
; | Catalyst 3000 Series Wiping Macro
; |======================================
; | Some unique shenanigans, since ROMMON is weird
; '--------------------------------------

; .======================================
; | Wait for stdout to finish spamming
; '--------------------------------------

include 'util/stdout.ttl'

sendln 'en'

; .======================================
; | Parse & wipe flash
; '--------------------------------------
include 'util\flash_wipe.ttl'

; .======================================
; | Wipe NVRAM & reboot
; '--------------------------------------
newstat = #10'Clearing NVRAM...'
include stat

setsync 1
timeout = 0
wait 'Switch#'
sendln 'write erase'
wait '[confirm]'
send #13

; .======================================
; | Reset config register from within IOS
; '--------------------------------------

wait 'Switch#'
sendln 'reload'
waitregex '\[yes/no\]' '\[confirm\]'
if result = 1 then
	sendln 'no'
	wait '[confirm]'
endif
send #13

wait 'Interrupt the system within 5 seconds'
sendbreak
pause 1
sendbreak
wait 'switch:'
	sendln 'set SWITCH_IGNORE_STARTUP_CFG 0'
	sendln 'set ENABLE_BREAK no'
endif

exit